<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Depo Stok Takip</title>
  <style>
    body{font-family:system-ui,Arial;background:#0b0f14;color:#e6edf3;margin:0}
    .wrap{max-width:1050px;margin:0 auto;padding:22px}
    h1{margin:0 0 12px}
    .card{background:#111823;border:1px solid #1d2a3a;border-radius:16px;padding:14px;margin:12px 0}
    .grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
    input,select,button{padding:10px;border-radius:10px;border:1px solid #253447;background:#0e1622;color:#e6edf3}
    button{cursor:pointer}
    button.primary{background:#1f6feb;border-color:#1f6feb}
    button.danger{background:#b42318;border-color:#b42318}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border-bottom:1px solid #1d2a3a;padding:10px;text-align:left;font-size:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #253447;font-size:12px}
    .low{border-color:#ffb020;color:#ffcf6e}
    .ok{border-color:#2ea043;color:#7ee787}
    .muted{color:#9fb1c5;font-size:13px;margin:8px 0 0}
    .right{display:flex;gap:8px;justify-content:flex-end}
    @media (max-width: 900px){ .grid{grid-template-columns:repeat(2,1fr)} }
  </style>
</head>
<body>
<div class="wrap">
  <h1>Depo Stok Takip</h1>

  <div class="card">
    <h2>ÃœrÃ¼n Ekle</h2>
    <div class="grid">
      <input id="p_name" placeholder="ÃœrÃ¼n adÄ±">
      <input id="p_sku" placeholder="SKU (benzersiz)">
      <input id="p_barcode" placeholder="Barkod (opsiyonel)">
      <input id="p_unit" placeholder="Birim (adet/kg/lt)" value="adet">
      <input id="p_min" placeholder="Min stok" type="number" step="0.01" value="0">
      <button class="primary" id="btnAddProduct">Ekle</button>
    </div>
    <div class="muted">Veriler bu cihazÄ±n tarayÄ±cÄ±sÄ±na kaydolur (localStorage). BaÅŸka cihazda gÃ¶rÃ¼nmez.</div>
  </div>

  <div class="card">
    <h2>Stok Hareketi</h2>
    <div class="grid">
      <select id="m_product"></select>
      <select id="m_type">
        <option value="IN">GiriÅŸ (+)</option>
        <option value="OUT">Ã‡Ä±kÄ±ÅŸ (-)</option>
        <option value="ADJ">DÃ¼zeltme (+/-)</option>
      </select>
      <input id="m_qty" placeholder="Miktar" type="number" step="0.01">
      <input id="m_note" placeholder="Not (opsiyonel)">
      <button class="primary" id="btnAddMove">Kaydet</button>
      <button id="btnReset">SÄ±fÄ±rla (test)</button>
    </div>
  </div>

  <div class="card">
    <div class="row">
      <h2 style="margin:0">Stok Durumu</h2>
      <span class="pill" id="stats"></span>
      <div class="right" style="margin-left:auto">
        <button id="btnExport">DÄ±ÅŸa Aktar (JSON)</button>
        <button id="btnImport">Ä°Ã§e Aktar (JSON)</button>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>ÃœrÃ¼n</th><th>SKU</th><th>Barkod</th><th>Stok</th><th>Birim</th><th>Min</th><th>Durum</th><th>Sil</th>
        </tr>
      </thead>
      <tbody id="tblStock"></tbody>
    </table>
  </div>

  <div class="card">
    <h2>Son Hareketler</h2>
    <table>
      <thead>
        <tr><th>Tarih</th><th>ÃœrÃ¼n</th><th>Tip</th><th>Miktar</th><th>Not</th></tr>
      </thead>
      <tbody id="tblMoves"></tbody>
    </table>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { 
    getAuth, 
    signInWithEmailAndPassword, 
    onAuthStateChanged, 
    signOut 
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
  import { 
    getFirestore, 
    collection, 
    addDoc, 
    onSnapshot, 
    query, 
    orderBy, 
    serverTimestamp 
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  // ðŸ”‘ Firebase config
  const firebaseConfig = {
  apiKey: "AIzaSyBkQ1PLIHZCHSxchaaFOnPZ2LcbnkFS_c",
  authDomain: "stok-1b644.firebaseapp.com",
  projectId: "stok-1b644",
  storageBucket: "stok-1b644.firebasestorage.app",
  messagingSenderId: "429744561222",
  appId: "1:429744561222:web:69a79f624651249e147e47"
};


  // Init
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // HTML elemanlarÄ±
  const emailEl = document.getElementById("email");
  const passEl = document.getElementById("pass");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const authState = document.getElementById("authState");

  const nameEl = document.getElementById("name");
  const qtyEl = document.getElementById("qty");
  const thrEl = document.getElementById("thr");
  const noteEl = document.getElementById("note");
  const saveBtn = document.getElementById("saveBtn");

  // ðŸ” Login
  loginBtn.onclick = async () => {
    await signInWithEmailAndPassword(
      auth,
      emailEl.value,
      passEl.value
    );
  };

  logoutBtn.onclick = () => signOut(auth);

  // Auth state
  onAuthStateChanged(auth, user => {
    if (user) {
      authState.textContent = "GiriÅŸ: " + user.email;
      logoutBtn.disabled = false;
    } else {
      authState.textContent = "GiriÅŸ yapÄ±lmadÄ±";
      logoutBtn.disabled = true;
    }
  });

  // ðŸ’¾ Firestore kaydet
  saveBtn.onclick = async () => {
    if (!nameEl.value) {
      alert("ÃœrÃ¼n adÄ± boÅŸ");
      return;
    }

    await addDoc(collection(db, "items"), {
      name: nameEl.value,
      qty: Number(qtyEl.value),
      threshold: Number(thrEl.value),
      note: noteEl.value,
      createdAt: serverTimestamp()
    });

    nameEl.value = "";
    qtyEl.value = 0;
    thrEl.value = 0;
    noteEl.value = "";
  };

  // ðŸ‘€ CanlÄ± dinleme (3 kiÅŸi aynÄ± anda gÃ¶rÃ¼r)
  const q = query(collection(db, "items"), orderBy("createdAt", "desc"));
  onSnapshot(q, snap => {
    console.log("GÃ¼ncel stok:", snap.docs.map(d => d.data()));
  });
</script>
</body>
</html>


